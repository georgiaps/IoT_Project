<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Microclimate And Traffic Analysis</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="header">
        <h1>City Microclimate And Traffic Analysis</h1>
    </div>
    <img src="logo.png" alt="Logo" class="logo">
    <nav class="nav">
        <button class="nav-button active" data-section="home">Home</button>
        <button class="nav-button" data-section="city-points">City Points Info</button>
        <button class="nav-button" data-section="diagrams">Diagrams</button>
        <button class="nav-button" data-section="alerts">Alerts-Problems</button>
        <button class="nav-button" data-section="contact-us">Contact Us</button> 

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
        <div class="search-container">
            <form action="/action_page.php">
                <input type="text" placeholder="Search..." name="search">
                <button type="submit"><i class="fa fa-search"></i></button>
            </form>
        </div>
        
    </nav>
    
    <main>
        <!-- Home Section -->
        <section id="home" class="section active">
            <div class="intro-container">
                <div class="intro">
                    <h2>Welcome to City Microclimate and Traffic Analysis</h2>
                    <p>
                        Our platform provides a comprehensive overview of microclimate conditions and traffic patterns in key locations around the city of Patras. 
                        Use the interactive map to explore real-time data from advanced IoT sensors on temperature, percipitacion, humidity and traffic 
                        congestion. With dynamic visualizations and timely alerts, we aim to enhance urban planning, improve traffic management, 
                        and contribute to a healthier, more sustainable city environment. Explore the data, monitor critical points, stay informed 
                        and make smarter decisions for your commute with our intuitive and innovative tools.
                    </p>
                </div>
                <div class="weather-overview">
                    <h2>Patras Weather Info</h2>
                    <div class="weather-content">
                        <img id="weather-icon" src="weather icons/default weather.png" alt="Weather Icon">
                        <div class="weather-overview-data">
                            <div class="weather-overview-item">
                                <span>Description:</span>
                                <span id="city-description">--</span>
                            </div>
                            <div class="weather-overview-item">
                                <span>Temperature:</span>
                                <span id="city-temperature">--</span>
                            </div>
                            <div class="weather-overview-item">
                                <span>Humidity:</span>
                                <span id="city-humidity">--</span>
                            </div>
                            <div class="weather-overview-item">
                                <span>Wind Speed:</span>
                                <span id="city-wind-speed">--</span>
                            </div>
                            <div class="weather-overview-item">
                                <span>Rain:</span>
                                <span id="city-rain">--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>   

            <div class="content">
                <div id="map"></div>
                <div class="locations">
                    <div class="location-item" data-location="Rio-Antirrio Bridge" style="color: #6d6a82;">
                        <div class="location-info">
                            <h3>Rio-Antirrio Bridge</h3>
                            <p>38.320745° N, 21.773224° E</p>
                        </div>
                    </div>
                    <div class="location-item" data-location="University Crossroad" style="color: #7091e6;">
                        <div class="location-info">
                            <h3>University Crossroad</h3>
                            <p>38.290672° N, 21.780164° E</p>
                        </div>
                    </div>
                    <div class="location-item" data-location="University of Patras" style="color: #27489c;">
                        <div class="location-info">
                            <h3>University of Patras</h3>
                            <p>38.286860° N, 21.787316° E</p>
                        </div>
                    </div>
                    <div class="location-item" data-location="Kastelokampos" style="color: #566487;">
                        <div class="location-info">
                            <h3>Kastelokampos</h3>
                            <p>38.289309° N, 21.773976° E</p>
                        </div>
                    </div>
                    <div class="location-item" data-location="Agyias Beach" style="color: #3d52a0;">
                        <div class="location-info">
                            <h3>Agyias Beach</h3>
                            <p>38.277013° N, 21.745342° E</p>
                        </div>
                    </div>
                    <div class="location-item" data-location="Kato Sychaina" style="color: #303a5c;">
                        <div class="location-info">
                            <h3>Kato Sychaina</h3>
                            <p>38.265289° N, 21.75704° E</p>
                        </div>
                    </div>
                    <div class="location-item" data-location="National Road Interchange" style="color: #47a3c2;">
                        <div class="location-info">
                            <h3>National Road Interchange</h3>
                            <p>38.262128° N, 21.750417° E</p>
                        </div>
                    </div>
                    <div class="location-item" data-location="Dasyllio" style="color: #515660;">
                        <div class="location-info">
                            <h3>Dasyllio</h3>
                            <p>38.248858° N, 21.745578° E</p>
                        </div>
                    </div>
                    <div class="location-item" data-location="Patras Centre" style="color: #5c52a0;">
                        <div class="location-info">
                            <h3>Patras Centre</h3>
                            <p>38.246877° N, 21.735854° E</p>
                        </div>
                    </div>
                    <div class="location-item" data-location="Gounarh Road" style="color: #7687b7;">
                        <div class="location-info">
                            <h3>Gounarh Road</h3>
                            <p>38.245566° N, 21.730981° E</p>
                        </div>
                    </div>
                    <div class="location-item" data-location="South Park" style="color: #5a87a0;">
                        <div class="location-info">
                            <h3>South Park</h3>
                            <p>38.237902° N, 21.725841° E</p>
                        </div>
                    </div>
                    <div class="location-item" data-location="Leuka" style="color: #805fa5;">
                        <div class="location-info">
                            <h3>Leuka</h3>
                            <p>38.206621° N, 21.727154° E</p>
                        </div>
                    </div>
                    <div class="location-item" data-location="Demenika" style="color: #566ba4;">
                        <div class="location-info">
                            <h3>Demenika</h3>
                            <p>38.200158° N, 21.743877° E</p>
                        </div>
                    </div>
                    <div class="location-item" data-location="Paralia" style="color: #2c6182;">
                        <div class="location-info">
                            <h3>Paralia</h3>
                            <p>38.199456° N, 21.699234° E</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- City Points Info Section -->
        <section id="city-points" class="section">
            <div class="loc-info">
                <!--<p>Select a location to view the weather and traffic information:</p>-->
                <div class="infodropdown">
                    <button>City Locations</button>
                    <div class="infodropdown-content"> 
                        <button data-location="Rio-Antirrio Bridge">Rio-Antirrio Bridge</button>
                        <button data-location="University Crossroad">University Crossroad</button>
                        <button data-location="University of Patras">University of Patras</button>
                        <button data-location="Kastelokampos">Kastelokampos</button>
                        <button data-location="Agyias Beach">Agyias Beach</button>
                        <button data-location="Kato Sychaina">Kato Sychaina</button>
                        <button data-location="National Road Interchange">National Road Interchange</button>
                        <button data-location="Dasyllio">Dasyllio</button>
                        <button data-location="Patras Centre">Patras Centre</button>
                        <button data-location="Gounarh Road">Gounarh Road</button>
                        <button data-location="South Park">South Park</button>
                        <button data-location="Leuka">Leuka</button>
                        <button data-location="Demenika">Demenika</button>
                        <button data-location="Paralia">Paralia</button>
                    </div>
                </div>
                <button class="refresh-button" >Refresh Data</button>

                <h2>Current Weather Conditions</h2>
                <div class="weather-grid">
                    <div class="weather-item">
                        <h3>Temperature</h3>
                        <p id="temperature">--</p>
                    </div>
                    <div class="weather-item">
                        <h3>Humidity</h3>
                        <p id="humidity">--</p>
                    </div>
                    <div class="weather-item">
                        <h3>Wind Speed</h3>
                        <p id="wind-speed">--</p>
                    </div>
                    <div class="weather-item">
                        <h3>Wind Direction</h3>
                        <p id="wind-direction">--</p>
                    </div>
                    <div class="weather-item">
                        <h3>Rain</h3>
                        <p id="rain">--</p>
                    </div>
                    <div class="weather-item">
                        <h3>Pressure</h3>
                        <p id="pressure">--</p>
                    </div>
                </div>
        
                <h2>Current Traffic Conditions</h2>
                <div class="traffic-grid">
                    <div class="traffic-item">
                        <h3>Current Speed</h3>
                        <p id="current-speed">--</p>
                    </div>
                    <div class="traffic-item">
                        <h3>Free Flow Speed</h3>
                        <p id="free-flow-speed">--</p>
                    </div>
                    <div class="traffic-item">
                        <h3>Traffic Percentage</h3>
                        <p id="traffic-percentage">--</p>
                    </div>
                </div>

                <h2>Microclimate Localized Forecast</h2>
                <div class="forecast-weather-grid">
                    <div class="forecast-weather-item">
                        <h3>Temperature</h3>
                        <p id="forecast-temperature">--</p>
                    </div>
                    <div class="forecast-weather-item">
                        <h3>Humidity</h3>
                        <p id="forecast-humidity">--</p>
                    </div>
                    <div class="forecast-weather-item">
                        <h3>Wind Speed</h3>
                        <p id="forecast-wind-speed">--</p>
                    </div>
                    <div class="forecast-weather-item">
                        <h3>Wind Direction</h3>
                        <p id="forecast-wind-direction">--</p>
                    </div>
                    <div class="forecast-weather-item">
                        <h3>Rain</h3>
                        <p id="forecast-rain">--</p>
                    </div>
                    <div class="forecast-weather-item">
                        <h3>Pressure</h3>
                        <p id="forecast-pressure">--</p>
                    </div>
                </div>
            </div>

        </section>

        <!-- Diagrams Section -->
        <section id="diagrams" class="section">

            <h2>Traffic & Weather Correlation</h2>
            <div class="diagram">
                <div class="diagramsdropdown">
                    <button>City Locations</button>
                    <div class="diagramsdropdown-content">
                        <button data-location="Rio-Antirrio Bridge">Rio-Antirrio Bridge</button>
                        <button data-location="University Crossroad">University Crossroad</button>
                        <button data-location="Agyias Beach">Agyias Beach</button>
                        <button data-location="National Road Interchange">National Road Interchange</button>
                        <button data-location="Dasyllio">Dasyllio</button>
                        <button data-location="Patras Centre">Patras Centre</button>
                        <button data-location="South Park">South Park</button>
                    </div>
                </div>
                <div id="diagram-container-correlation">
                    <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                        <img src="correlation_diagrams/Default/diagram_today.png" 
                             alt="Default Today Correlation Diagram" 
                             style="width: 30%; border: 2px solid #ccc; border-radius: 5px;">
                        <img src="correlation_diagrams/Default/diagram_yesterday.png" 
                             alt="Default Yesterday Correlation Diagram" 
                             style="width: 30%; border: 2px solid #ccc; border-radius: 5px;">
                        <img src="correlation_diagrams/Default/diagram_two_days_ago.png" 
                             alt="Default Two Days Ago Correlation Diagram" 
                             style="width: 30%; border: 2px solid #ccc; border-radius: 5px;">
                    </div>
                </div>
            </div>

            <h2>Weather Conditions Comparison</h2>
            <div class="diagram-container">
                <div class="diagram">
                    <iframe src="https://labserver.sense-campus.gr:8087/d-solo/ae86wq8xjs8aoe/weather-conditions-comparison?timezone=browser&orgId=2&theme=light&panelId=1&__feature.dashboardSceneSolo" width="450" height="200" frameborder="0"></iframe>
                </div>
                <div class="diagram">
                    <iframe src="https://labserver.sense-campus.gr:8087/d-solo/ae86wq8xjs8aoe/weather-conditions-comparison?timezone=browser&orgId=2&theme=light&panelId=2&__feature.dashboardSceneSolo" width="450" height="200" frameborder="0"></iframe>
                </div>
            </div>

            <h2>Historical Insights</h2>
            <div class="diagram-container">
                <div class="diagram">
                </div>
            </div>
        </section>

        <!-- Alerts-Problems Section -->
        <section id="alerts" class="section">
            <h2>Current Alerts</h2>
            <p>No active alerts at this time.</p>
        </section>

        <!-- Contact Us Section -->
        <section id="contact-us" class="section">
            
            <!-- Team Section -->
            <div class="team-container">
                <h3>Meet Our Team</h3>
                <p>We'd love to hear from you! Reach out to any of our team members below:</p>
                <div class="team-members">
                    <div class="team-member">
                        <img src="team_member_1.jpg" alt="Team Member 1">
                        <h4>Ariadne Fyrogeni</h4>
                        <p>ECE Student</p>
                        <div class="contact-details">
                            <p><strong>Email:</strong> up1083816@ac.upatras.gr</p>
                            <p><strong>Phone:</strong> +306940505767</p>
                        </div>
                        <div class="social-links">
                            <a href="mailto:up1083816@ac.upatras.gr">Email</a> | 
                            <a href="https://www.linkedin.com/in/ariadne-fyrogeni-591853228/" target="_blank">LinkedIn</a>
                        </div>
                    </div>
                    <div class="team-member">
                        <img src="team_member_2.jpg" alt="Team Member 2">
                        <h4>Georgia Psychogiou</h4>
                        <p>ECE Student</p>
                        <div class="contact-details">
                            <p><strong>Email:</strong> up1083979@ac.upatras.gr</p>
                            <p><strong>Phone:</strong> +306988097895</p>
                        </div>
                        <div class="social-links">
                            <a href="mailto:up1083979@ac.upatras.gr">Email</a> | 
                            <a href="https://www.linkedin.com/in/%CE%B3%CE%B5%CF%89%CF%81%CE%B3%CE%AF%CE%B1-%CF%88%CF%85%CF%87%CE%BF%CE%B3%CE%B9%CE%BF%CF%8D-20a076331/" target="_blank">LinkedIn</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 City Microclimate and Traffic Analysis</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script>
        window.onload = function() {
            window.scrollTo({
                top: 0,
                left: 0,
                behavior: 'smooth'
            });
        };

        // Weather icon mapping
        const weatherIcons = {
            'clear sky': 'weather icons/clear sky.png',
            'few clouds': 'weather icons/few clouds.png',
            'scattered clouds': 'weather icons/scattered clouds.png',
            'broken clouds': 'weather icons/broken clouds.png',
            'overcast clouds': 'weather icons/broken clouds.png',
            'shower rain': 'weather icons/shower rain.png',
            'light rain': 'weather icons/shower rain.png',
            'moderate rain': 'weather icons/shower rain.png',
            'heavy intensity rain': 'weather icons/shower rain.png',
            'very heavy rain': 'weather icons/shower rain.png',
            'extreme rain': 'weather icons/shower rain.png',
            'rain': 'weather icons/rain.png',
            'drizzle': 'weather icons/rain.png',
            'drizzle rain': 'weather icons/rain.png',
            'thunderstorm': 'weather icons/thunderstorm.png',
            'thunderstorm with light rain': 'weather icons/thunderstorm.png',
            'thunderstorm with rain': 'weather icons/thunderstorm.png',
            'thunderstorm with heavy rain': 'weather icons/thunderstorm.png',
            'thunderstorm with drizzle': 'weather icons/thunderstorm.png',
            'light thunderstorm': 'weather icons/thunderstorm.png',
            'heavy thunderstorm': 'weather icons/thunderstorm.png',
            'snow': 'weather icons/snow.png',
            'light snow': 'weather icons/snow.png',
            'light rain and snow': 'weather icons/snow.png',
            'mist': 'weather icons/mist.png', 
            'haze': 'weather icons/mist.png', 
            'fog': 'weather icons/mist.png', 
            'dust': 'weather icons/mist.png',            
        };

        // Function to update city weather overview
        function updateCityWeather(data) {
            if (!data || !data.Patras || !data.Patras.weather) return;

            const cityWeather = data.Patras.weather || {};;
            
            // Update weather icon
            const weatherIcon = document.getElementById('weather-icon');
            const description = cityWeather.Description?.toLowerCase() || 'clear sky';
            weatherIcon.src = weatherIcons[description] || 'default weather.png';


            // Helper function to handle display values with units
            const displayValue = (value, unit) => {
                if (value !== undefined && value !== null && value !== '') {
                    return value + unit;
                }
                return '--';
            };
            
            // Update weather data
            document.getElementById('city-description').textContent = cityWeather.Description || '--';
            document.getElementById('city-temperature').textContent = displayValue(cityWeather.Temperature, '°C');
            document.getElementById('city-humidity').textContent = displayValue(cityWeather.Humidity, '%');
            document.getElementById('city-wind-speed').textContent = displayValue(cityWeather['Wind Speed'], ' km/h');
            document.getElementById('city-rain').textContent = displayValue(cityWeather.Rain, ' mm');
        }

        function fetchGeneralCityWeather() {
            fetch('http://172.20.10.6:8080/api/city-data')
                .then(response => response.json())
                .then(data => {
                    updateCityWeather(data);
                })
                .catch(error => console.error('Error fetching city data:', error));
        }

        // Call this when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            fetchGeneralCityWeather();
        });
        
        const map = L.map('map').setView([38.273530, 21.730154], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        const locations = [
            { name: 'Rio-Antirrio Bridge', coords: [38.320745, 21.773224], color: '#6d6a82' },
            { name: 'University Crossroad', coords: [38.290672, 21.780164], color: '#7091e6' },
            { name: 'University of Patras', coords: [38.286860,21.787316], color: '#27489c' },
            { name: 'Kastelokampos', coords: [38.2893, 21.7739], color: '#566487' },
            { name: 'Agyias Beach', coords: [38.277013, 21.745342], color: '#3d52a0' },
            { name: 'Kato Sychaina', coords: [38.2652,21.757], color: '#303a5c' },
            { name: 'National Road Interchange', coords: [38.262128, 21.750417], color: '#47a3c2' },
            { name: 'Dasyllio', coords: [38.248858, 21.745578], color: '#515660' },
            { name: 'Patras Centre', coords: [38.246877, 21.735854], color: '#5c52a0' },
            { name: 'Gounarh Road', coords: [38.245566, 21.730981], color: '#7687b7' },
            { name: 'South Park', coords: [38.237902, 21.725841], color: '#5a87a0' },
            { name: 'Leuka', coords: [38.2066,21.7271], color: '#805fa5' },
            { name: 'Demenika', coords: [38.2001,21.7438], color: '#566ba4' },
            { name: 'Paralia', coords: [38.1994,21.6992], color: '#2c6182' }
        ];

        const locationWeatherInfo = document.getElementById('loc-info');
        const locationTrafficInfo = document.getElementById('loc-info');

        // Get the user's geolocation
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, handleError, {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 0
                });
            } else {
                console.log("Geolocation is not supported by this browser.");
            }
        }

        function showPosition(position) {
            const userLat = position.coords.latitude;
            const userLon = position.coords.longitude;

            // Move the map to the user's location
            map.setView([userLat, userLon], 13);

            // Add a marker for the user's location
            L.marker([userLat, userLon])
                .addTo(map)
                .bindPopup("You are here!")
                .openPopup();

            
            // Clear weather and traffic info
            document.getElementById('temperature').textContent = "--";
            document.getElementById('humidity').textContent = "--";
            document.getElementById('wind-speed').textContent = "--";
            document.getElementById('wind-direction').textContent = "--";
            document.getElementById('rain').textContent = "--";
            document.getElementById('pressure').textContent = "--";
            
            document.getElementById('current-speed').textContent = "--";
            document.getElementById('free-flow-speed').textContent = "--";
            document.getElementById('traffic-percentage').textContent = "--";
        }
        
        // Call getLocation on page load
        getLocation();

        // Set up the section navigation
        document.querySelectorAll('.nav-button').forEach(button => {
            button.addEventListener('click', () => {
                switchSection(button.dataset.section);
            });
        });

        // Switch the section navigation
        function switchSection(sectionId) {
            document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            
            const button = document.querySelector(`[data-section="${sectionId}"]`);
            if (button) button.classList.add('active');
            
            const section = document.getElementById(sectionId);
            if (section) section.classList.add('active');
        }

        // Function to show City Points section
        function showCityPointsSection() {
            document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            
            const cityPointsButton = document.querySelector('[data-section="city-points"]');
            cityPointsButton.classList.add('active');
            document.getElementById('city-points').classList.add('active');
        }

        // Update weather and traffic location info when a location point is clicked
        document.querySelectorAll('.location-item').forEach(item => {
            item.addEventListener('click', () => {
                const locationName = item.getAttribute('data-location');
                if (locationName) {
                    switchSection('city-points');
                    updateWeatherLocationInfo(locationName);
                    updateTrafficLocationInfo(locationName);
                }
            });
        });

        // Custom marker icon definition
        const createCustomMarker = (color) => {
            return L.divIcon({
                html: `<svg width="14" height="26" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 0C5.37 0 0 5.37 0 12c0 8.4 12 20 12 20s12-11.6 12-20c0-6.63-5.37-12-12-12zm0 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4z" 
                    fill="${color}"/>
                </svg>`,
                className: 'custom-marker',
                iconSize: [14, 26],
                iconAnchor: [7, 26],
                popupAnchor: [0, -32]
            });
        };

        // Update weather and traffic location info when a marker in map is clicked
        locations.forEach(loc => {
            const marker = L.marker(loc.coords, {
                icon: createCustomMarker(loc.color)
            })
            .bindPopup(`
                <div class="marker-popup">
                    <h3>${loc.name}</h3>
                </div>
            `)
            .addTo(map)
            .on('click', () => {
                switchSection('city-points');
                updateWeatherLocationInfo(loc.name);
                updateTrafficLocationInfo(loc.name);
            });

            // Open popup on hover
            marker.on('mouseover', function (e) {
                this.openPopup();
            });

            // Close popup when mouse leaves
            marker.on('mouseout', function (e) {
                this.closePopup();
            });
        });

        // Update weather and traffic location info when infodropdown selection changes
        document.querySelectorAll('.infodropdown-content button').forEach(button => {
            button.addEventListener('click', () => {
                const locationName = button.dataset.location;
                if (locationName) {
                    updateWeatherLocationInfo(locationName);
                    updateTrafficLocationInfo(locationName);
                    updateinfodropdownButton(locationName);
                }
            });
        });

        const infodropdownButton = document.querySelector('.infodropdown button');

        // Function to update the infodropdown button text
        function updateinfodropdownButton(locationName) {
            if (infodropdownButton) {
                infodropdownButton.textContent = locationName;
            }
            document.querySelectorAll('.infodropdown-content button').forEach(button => {
                button.classList.remove('active');
                if (button.dataset.location === locationName) {
                    button.classList.add('active');
                }
            });
        }

        document.addEventListener('DOMContentLoaded', fetchCityData);
        document.querySelector('.refresh-button').addEventListener('click', fetchCityData);

        let currentSelectedLocation = '';

        function fetchCityData() {
            /*fetch('http://192.168.1.6:8080/api/city-data') georgia*/
            /*fetch('http://192.168.1.144:8080/api/city-data') giorgos*/
            /*fetch('http://192.168.1.6:8080/api/city-data')*/
            fetch('http://172.20.10.6:8080/api/city-data') /*atout*/
                .then(response => response.json())
                .then(data => {
                    if (currentSelectedLocation) {
                        updateFrontend(data, currentSelectedLocation);
                    }
                })
                .catch(error => console.error('Error fetching city data:', error));
        }

        // Update weather and traffic info
        function updateFrontend(data, location) {
            const locationData = data[location];
            if (!locationData) return;

            const weather = locationData.weather || {};
            const traffic = locationData.traffic || {};

            // Helper function to handle display values with units
            const displayValue = (value, unit) => {
                if (value !== undefined && value !== null && value !== '') {
                    return value + unit;
                }
                return '--';
            };

            // Weather information
            document.getElementById('temperature').textContent = displayValue(weather.Temperature, '°C');
            document.getElementById('humidity').textContent = displayValue(weather.Humidity, '%');
            document.getElementById('wind-speed').textContent = displayValue(weather['Wind Speed'], ' km/h');
            document.getElementById('wind-direction').textContent = displayValue(weather['Wind Direction'], '°');
            document.getElementById('rain').textContent = displayValue(weather.Rain, ' mm');
            document.getElementById('pressure').textContent = displayValue(weather.Pressure, ' hPa');

            // Traffic information
            document.getElementById('current-speed').textContent = displayValue(traffic['Current Speed'], ' km/h');
            document.getElementById('free-flow-speed').textContent = displayValue(traffic['Free Flow Speed'], ' km/h');
            document.getElementById('traffic-percentage').textContent = displayValue(((traffic['Traffic Percentage'])*100).toFixed(0), '%');
        }

        // Update weather info when location changes
        function updateWeatherLocationInfo(location) {
            currentSelectedLocation = location;
            updateinfodropdownButton(location);
            fetchCityData(); // Fetch fresh data when location changes
        }

        // Update traffic info when location changes
        function updateTrafficLocationInfo(location) {
        }

        // Add periodic data refresh (optional)
        setInterval(fetchCityData, 30000);

        // Reference the search input and form
        const searchInput = document.querySelector('.search-container input[type="text"]');
        const searchForm = document.querySelector('.search-container form');

        // Event listener for the search form submission
        searchForm.addEventListener('submit', (event) => {
            event.preventDefault(); // Prevent the default form submission

            const searchTerm = searchInput.value.trim().toLowerCase();
            if (!searchTerm) return alert('Please enter a location name.');

            // Find the matching location
            const location = locations.find(loc => loc.name.toLowerCase().includes(searchTerm));
            if (!location) return alert('Location not found. Please try again.');

            // Navigate to the "City Points Info" section
            switchSection('city-points');

            // Update weather and traffic information
            updateWeatherLocationInfo(location.name);
            updateTrafficLocationInfo(location.name);

            // Highlight the matching location in the infodropdown (optional)
            document.querySelectorAll('.infodropdown-content button').forEach(button => {
                button.classList.remove('active');
                if (button.dataset.location === location.name) {
                    button.classList.add('active');
                }
            });
        });

        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.diagramsdropdown-content button').forEach(button => {
                button.addEventListener('click', function () {
                    const location = this.getAttribute('data-location');
                    const diagramContainer = document.getElementById('diagram-container-correlation');

                    // Check if the container exists
                    if (!diagramContainer) {
                        console.error('Error: diagram-container-correlation not found in the DOM.');
                        return;
                    }

                    // Update dropdown button text
                    const diagramsdropdownButton = document.querySelector('.diagramsdropdown button');
                    if (diagramsdropdownButton) {
                        diagramsdropdownButton.textContent = location;
                    }

                    // Get the current date
                    const today = new Date();

                    // Generate the last 3 dates
                    const dates = [];
                    for (let i = 0; i < 3; i++) {
                        const date = new Date(today);
                        date.setDate(today.getDate() - i);
                        const formattedDate = date.toISOString().split('T')[0];
                        dates.push(formattedDate);
                    }

                    // Clear existing images
                    diagramContainer.innerHTML = '';

                    // Create a flex container for the images
                    const flexContainer = document.createElement('div');
                    flexContainer.style.display = 'flex';
                    flexContainer.style.justifyContent = 'space-between';
                    flexContainer.style.marginTop = '20px';

                    // Load images
                    dates.forEach(date => {
                        const img = document.createElement('img');
                        img.src = `correlation_diagrams/${location}/${date}.png`;
                        img.alt = `${location} - ${date} Correlation Diagram`;
                        img.style.width = '30%';
                        img.style.border = '2px solid #ccc';
                        img.style.borderRadius = '5px';

                        // Add error handling
                        img.onerror = () => {
                            img.style.display = 'none';
                            console.error(`Image not found: ${img.src}`);
                        };

                        flexContainer.appendChild(img);
                    });

                    diagramContainer.appendChild(flexContainer);

                    // Update the dropdown button and active state
                    document.querySelectorAll('.diagramsdropdown-content button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                });
            });
        });

        const diagramsdropdownButton = document.querySelector('.diagramsdropdown button');

        // Function to update the diagramsdropdown button text
        function updatediagramsdropdownButton(locationName) {
            if (diagramsdropdownButton) {
                diagramsdropdownButton.textContent = locationName;
            }
            document.querySelectorAll('.diagramsdropdown-content button').forEach(button => {
                button.classList.remove('active');
                if (button.dataset.location === locationName) {
                    button.classList.add('active');
                }
            });
        }

        function handleError(error) {
            let errorMessage = "";
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage = "Please enable location services to use this feature.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage = "Location information is currently unavailable.";
                    break;
                case error.TIMEOUT:
                    errorMessage = "Location request timed out. Please try again.";
                    break;
                default:
                    errorMessage = "An unknown error occurred while getting location.";
                    break;
            }
            console.log(errorMessage);
        }
    </script>
</body>
</html>